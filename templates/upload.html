<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <title>Tải tài liệu HaUI - Gemini File Search</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
<header>
    <h1>Quản lý tài liệu HaUI</h1>
    <nav>
        <a href="{{ url_for('chat_page') }}">Chat</a>
        <a href="{{ url_for('upload_page') }}">Upload</a>
    </nav>
</header>

<main class="upload-container">
    <form id="upload-form" enctype="multipart/form-data">
        <label for="file">Chọn file PDF/DOCX/TXT quy định của trường:</label>
        <input type="file" id="file" name="file" required />
        <button type="submit">Tải lên</button>
    </form>

    <div id="upload-result" class="upload-result"></div>
</main>

<script>
    const uploadForm = document.getElementById("upload-form");
    const resultDiv = document.getElementById("upload-result");

    uploadForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        resultDiv.textContent = "Đang tải lên và index tài liệu...";

        const formData = new FormData(uploadForm);

        try {
            const res = await fetch("/api/upload", {
                method: "POST",
                body: formData,
            });

            const data = await res.json();
            if (data.message) {
                resultDiv.textContent = data.message + " (Store: " + data.store_name + ")";
            } else if (data.error) {
                resultDiv.textContent = "Lỗi: " + data.error;
            } else {
                resultDiv.textContent = "Có lỗi không xác định.";
            }
        } catch (err) {
            resultDiv.textContent = "Lỗi kết nối tới server.";
        }
    });
</script>
</body>
</html>
